<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8' />
{% load static %}
<link href='{% static 'fullcalendar.css' %}' rel='stylesheet' />
<link href='{% static 'fullcalendar.print.css' %}' rel='stylesheet' media='print' />
<script src='{% static 'lib/moment.min.js' %}'></script>
<script src='{% static 'lib/jquery.min.js' %}'></script>
<script src='{% static 'fullcalendar.js' %}'></script>
<script type='text/javascript' src='{% static 'gcal.js' %}'></script>

<script src="https://apis.google.com/js/platform.js" async defer></script>
<meta name="google-signin-client_id" content="777718038660-ob329re48n6vapuo4ebah4ssq5gdqrvn.apps.googleusercontent.com">
<script src="https://apis.google.com/js/platform.js?onload=init" async defer></script>
<script>


  function onSignIn(googleUser) {
    var profile = googleUser.getBasicProfile();
    console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
    console.log('Name: ' + profile.getName());
    console.log('Image URL: ' + profile.getImageUrl());
    console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.
    var options = new gapi.auth2.SigninOptionsBuilder(
      {'scope': 'email https://www.googleapis.com/auth/calendar'});

    var auth2 = gapi.auth2.getAuthInstance();
    googleUser = auth2.currentUser.get();
    googleUser.grant(options).then(
      function(success){
        console.log(JSON.stringify({message: "success", value: success}));
      },
      function(fail){
        console.log(JSON.stringify({message: "fail", value: fail}));
      });
  };

  function signOut() {
    var auth2 = gapi.auth2.getAuthInstance();
    auth2.signOut().then(function () {
      console.log('User signed out.');
    });
  };

  $(document).ready(function() {

    $('#calendar').fullCalendar({
      header: {
        left: 'prev,next today',
        center: 'title',
        right: 'month,agendaWeek,agendaDay'
      },
      defaultDate: '2018-03-12', // TODO change it to current day
      navLinks: true, // can click day/week names to navigate views
      selectable: true,
      selectHelper: true,
      select: function(start, end) {
        var title = prompt('Event Title:');
        var eventData;
        if (title) {
          eventData = {
            title: title,
            start: start,
            end: end
          };
          $('#calendar').fullCalendar('renderEvent', eventData, true); // stick? = true
        }
        $('#calendar').fullCalendar('unselect');
      },
      editable: true,
      eventLimit: true, // allow "more" link when too many events
      googleCalendarApiKey: 'AIzaSyAB7Zfk1cIw5ejq6x8Kol3qwNCv7R0NTJg',
      events: {
        googleCalendarId: 'dzlu1053455285@gmail.com'
      }
    });

  });


  
</script>
<style>

  body {
    margin: 40px 10px;
    padding: 0;
    font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
    font-size: 14px;
  }

  #calendar {
    max-width: 900px;
    margin: 0 auto;
  }

</style>
</head>
<body>
  <div class="g-signin2" data-onsuccess="onSignIn"></div>
  <button name = "accessCalendar" action="accessCalendar">accessCalendar</button>
  <a href="#" onclick="signOut();">Sign out</a>
  <div id='calendar'></div>

</body>
</html>
