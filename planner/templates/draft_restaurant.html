<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <title>Document</title>
</head>
<style>
        /* Always set the map height explicitly to define the size of the div
         * element that contains the map. */
        #map {
          height: 100%;
        }
        /* Optional: Makes the sample page fill the window. */
        html, body {
          height: 100%;
          margin: 0;
          padding: 0;
        }
        div.res_box {
          width: 300px;
          border: 25px solid rgb(8, 139, 52);
          padding: 25px;
        }
      </style>
    </head>
    <body>
      <div id="map"></div>
      <ol id="restaurants">

      </ol>
      <script>
        // Note: This example requires that you consent to location sharing when
        // prompted by your browser. If you see the error "The Geolocation service
        // failed.", it means you probably did not give permission for the browser to
        // locate you.
        var map, infoWindow;

        function callback(results, status) {
            if (status == google.maps.places.PlacesServiceStatus.OK) {
              for (var i = 0; i < results.length; i++) {
                var place = results[i];
                createMarker(results[i]);
                // create a list of info
                addrestaurant(place);
              }
              console.log(results);
              return results;
            }
          }
          function addrestaurant(restaurant){
            var x = document.createElement("DIV");
            x.className = "res_box";
            var t = document.createTextNode(restaurant.name);
            x.appendChild(t);
            if(restaurant.photos){
              var i = document.createElement("IMG");
              i.setAttribute("src", restaurant.photos[0].getUrl({'maxWidth': 50, 'maxHeight': 50}));
              i.setAttribute("alt", restaurant.name);
              x.appendChild(i);
            }
            var rating = document.createTextNode("Google Rating:  " + restaurant.rating);
            

            //.getUrl({'maxWidth': 35, 'maxHeight': 35})
            var loc = document.createTextNode(restaurant.vicinity);
            x.appendChild(document.createElement("br"));
            x.appendChild(loc);
            x.appendChild(document.createElement("br"));
            x.appendChild(rating);
            document.body.appendChild(x);
            document.getElementById("restaurants").appendChild(x);
          }
        function initMap() {
          map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: -34.397, lng: 150.644},
            zoom: 15
          });
          infoWindow = new google.maps.InfoWindow;
  
          // Try HTML5 geolocation.
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
              var pos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
              };
  
              infoWindow.setPosition(pos);
              infoWindow.setContent('Location found.');
              infoWindow.open(map);
              map.setCenter(pos);
              var request = {
                location: pos,
                radius: '500',
                type: ['restaurant']
              };
            console.log(request);
              service = new google.maps.places.PlacesService(map);
              service.nearbySearch(request, callback);
              
            }, function() {
              handleLocationError(true, infoWindow, map.getCenter());
            });
          } else {
            // Browser doesn't support Geolocation
            handleLocationError(false, infoWindow, map.getCenter());
          }
        }
        function createMarker(place) {
          var photos = place.photos;
          if (!photos) {
            new google.maps.Marker({
              position: place.geometry.location,
              map: map
            });
            return;
          }
        
          var marker = new google.maps.Marker({
            map: map,
            position: place.geometry.location,
            title: place.name,
          });
        }
        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
          infoWindow.setPosition(pos);
          infoWindow.setContent(browserHasGeolocation ?
                                'Error: The Geolocation service failed.' :
                                'Error: Your browser doesn\'t support geolocation.');
          infoWindow.open(map);
        }
       
      </script>
  
        <script async defer
          src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAB7Zfk1cIw5ejq6x8Kol3qwNCv7R0NTJg&libraries=places&callback=initMap">
        </script>
</body>

</html>